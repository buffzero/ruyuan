<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>《如鸢》密探升级 & 修为助手</title>
<style>
:root{--bg:#1b1b1e;--fg:#e0e0e3;--accent:#7db7ff;--card:#26262b;}
@media(prefers-color-scheme:light){:root{--bg:#fafafa;--fg:#222;--card:#fff;}}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,'PingFang SC',Helvetica,Arial,sans-serif;background:var(--bg);color:var(--fg);}
h1{font-size:1.4rem;margin:1rem;}
.container{max-width:1100px;margin:0 auto;padding:1rem;display:grid;gap:1rem;}
@media(min-width:992px){.container{grid-template-columns:1fr 1fr;}}
.card{background:var(--card);padding:1rem;border-radius:8px;box-shadow:0 0 6px rgba(0,0,0,.2);}
label{display:block;margin:.5rem 0 .2rem;}
select,input{width:100%;padding:.4rem;border:1px solid #999;border-radius:4px;background:var(--bg);color:var(--fg);}
button{margin-top:.6rem;padding:.5rem;border:none;border-radius:4px;background:var(--accent);color:#fff;font-weight:600;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:.8rem;font-size:.85rem}
th,td{border:1px solid #555;padding:.4rem;text-align:center}
.toggle{font-size:.8rem;text-decoration:underline;color:var(--accent);cursor:pointer;margin-top:.5rem}
.hidden{display:none}
</style>
</head>
<body>
<h1>《如鸢》密探升级 & 修为助手</h1>
<div class="container">
  <div class="card">
    <h2>修为材料估算</h2>
    <label>修为路线</label>
    <select id="path">
      <option value="地水">地水</option>
      <option value="风火">风火</option>
      <option value="阴阳">阴阳</option>
    </select>
    <label>当前修为级</label>
    <select id="curTier"></select>
    <label>目标修为级</label>
    <select id="tarTier"></select>
    <label>选择最优历练层</label>
    <select id="floor">
      <option value="2">2</option>
      <option value="4">4</option>
      <option value="6">6</option>
      <option value="8">8</option>
      <option value="10">10</option>
      <option value="12">12</option>
    </select>
    <button id="calcCult">计算</button>
    <button id="resetCult" style="background:#e74c3c">撤销</button>
    <div id="cultResult"></div>
    <div class="toggle" onclick="document.querySelector('#allFloors').classList.toggle('hidden')">显示/隐藏全部历练掉落表</div>
    <div id="allFloors" class="hidden"></div>
  </div>
</div>
<script>
// tiers
const curT=document.getElementById('curTier'),tarT=document.getElementById('tarTier');
for(let i=1;i<=17;i++){curT.innerHTML+=`<option value="${i}">${i}</option>`;tarT.innerHTML+=`<option value="${i}">${i}</option>`;}
curT.value=1;tarT.value=5;
// drops
const drops={
 '地水':{2:{'浊酒':25},4:{'浊酒':30,'清酒':20},6:{'清酒':40,'百末旨酒':30},8:{'百末旨酒':45,'灵山泉':35},10:{'灵山泉':50,'霸王泪':40},12:{'灵山泉':60,'霸王泪':45}},
 '风火':{2:{'绢扇':25},4:{'绢扇':30,'翠扇':20},6:{'翠扇':40,'金丝扇':30},8:{'金丝扇':45,'羽扇':35},10:{'羽扇':50,'悲回风扇':40},12:{'羽扇':60,'悲回风扇':45}},
 '阴阳':{2:{'铜镜':25},4:{'铜镜':30,'六博镜':20},6:{'六博镜':40,'鎏金镜':30},8:{'鎏金镜':45,'宝石镜':35},10:{'宝石镜':50,'水镜':40},12:{'宝石镜':60,'水镜':45}}
};
// tier needs基表
const base=[
['浊酒',[0,20,40,60,60,0,0,0,0,0,0,0,0,0,0,0,0]],
['清酒',[0,0,0,50,80,80,100,120,140,0,0,0,0,0,0,0,0]],
['百末旨酒',[0,0,0,0,0,120,150,180,210,240,260,280,0,0,0,0,0]],
['灵山泉',[0,0,0,0,0,0,0,0,0,360,390,420,440,460,480,0,0]],
['霸王泪',[0,0,0,0,0,0,0,0,0,0,0,0,660,690,720,600,750]],
['木兰坠露',[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,900,1200]]
];
const map={
 '地水':{'浊酒':'浊酒','清酒':'清酒','百末旨酒':'百末旨酒','灵山泉':'灵山泉','霸王泪':'霸王泪','木兰坠露':'木兰坠露'},
 '风火':{'浊酒':'绢扇','清酒':'翠扇','百末旨酒':'金丝扇','灵山泉':'羽扇','霸王泪':'悲回风扇','木兰坠露':'木兰坠露'},
 '阴阳':{'浊酒':'铜镜','清酒':'六博镜','百末旨酒':'鎏金镜','灵山泉':'宝石镜','霸王泪':'水镜','木兰坠露':'星汉镜'}
};
function calc(){
 const path=document.getElementById('path').value;
 let cur=parseInt(curT.value),tar=parseInt(tarT.value),floor=parseInt(document.getElementById('floor').value);
 if(tar<=cur){alert('目标修为必须高于当前');return;}
 let need={},drop=drops[path][floor];
 base.forEach(([src,list])=>{
   list.forEach((n,i)=>{let lvl=i+1;if(lvl>cur&&lvl<=tar&&n){let dst=map[path][src];need[dst]=(need[dst]||0)+n;}});
 });
 let runs=0;for(let k in need){if(drop[k])runs=Math.max(runs,Math.ceil(need[k]/drop[k]));}
 let html='<table><tr><th>材料</th><th>需求</th></tr>';
 for(let k in need){html+=`<tr><td>${k}</td><td>${need[k]}</td></tr>`;}html+='</table>';
 html+=`<p>刷第${floor}层预计需 <b>${runs}</b> 次。</p >`;
 document.getElementById('cultResult').innerHTML=html;
}
document.getElementById('calcCult').onclick=calc;
document.getElementById('resetCult').onclick=()=>{document.getElementById('cultResult').innerHTML='';};
function buildAll(){let h='<table><tr><th>路线</th><th>层</th><th>掉落</th></tr>';for(let p in drops){for(let f in drops[p]){let s=Object.entries(drops[p][f]).map(([k,v])=>k+'×'+v).join('、');h+=`<tr><td>${p}</td><td>${f}</td><td>${s}</td></tr>`;}}h+='</table>';document.getElementById('allFloors').innerHTML=h;}
buildAll();
</script>
</body></html>
